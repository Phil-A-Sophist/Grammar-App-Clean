<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grammar App</title>
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f5f5f5;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* Header with buttons flanking the title */
    .app-header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 10px;
      padding: 6px 20px;
      background: #ffffff;
      border-bottom: 2px solid #ddd;
      flex-shrink: 0;
    }
    .app-header h1 {
      margin: 0;
      color: #333;
      font-size: 20px;
    }
    .header-left,
    .header-right {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .header-left {
      justify-content: flex-start;
    }
    .header-right {
      justify-content: flex-end;
      gap: 8px;
    }
    .export-btn {
      border: 1px solid #333;
      background: white;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
      font-size: 13px;
      padding: 6px 10px;
      transition: background 0.2s;
    }
    .export-btn:hover {
      background: #f0f0f0;
    }
    .export-status {
      font-size: 11px;
      color: #666;
      margin: 0 10px;
      min-height: 1em;
    }

    /* Compact palette sections */
    .palette-section {
      background-color: #fff;
      border: 1px solid #ddd;
      margin: 4px 12px;
      padding: 6px 10px;
      border-radius: 6px;
      flex-shrink: 0;
    }

    .palette-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 6px;
      margin: 0;
    }

    /* Compact tile sizes */
    .clauses-section .palette-tile,
    .phrases-section .palette-tile {
      width: 50px;
      height: 26px;
      font-size: 10px;
    }

    .open-class-section .palette-tile {
      width: 58px;
      height: 26px;
      font-size: 10px;
    }

    .closed-class-section .palette-tile {
      width: 50px;
      height: 26px;
      font-size: 9px;
    }

    .palette-tile {
      border-radius: 5px;
      border: 2px solid rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: grab;
      user-select: none;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .palette-tile:hover {
      transform: scale(1.1);
    }

    .palette-tile:active {
      cursor: grabbing;
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 100;
    }

    .palette-tile.white-bg {
      border: 2px solid #333;
      color: #333;
    }

    .palette-tile.dragging {
      opacity: 0.6;
    }

    /* Top and bottom palette containers */
    .top-palettes, .bottom-palettes {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 4px;
      padding: 4px 8px;
      flex-shrink: 0;
    }

    .top-palettes .palette-section,
    .bottom-palettes .palette-section {
      margin: 2px 4px;
    }

    /* Canvas wrapper - fills remaining space */
    #canvas-wrapper {
      position: relative;
      background-color: #fff;
      border: 3px solid #333;
      margin: 6px 12px;
      border-radius: 8px;
      overflow: hidden;
      flex: 1;
      min-height: 200px;
    }

    .zoom-controls {
      position: absolute;
      top: 8px;
      right: 8px;
      z-index: 10;
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .zoom-controls button {
      height: 26px;
      border: 1px solid #333;
      background: white;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
      font-size: 13px;
      padding: 0 6px;
    }

    #zoom-in, #zoom-out {
      width: 26px;
    }

    #zoom-reset {
      min-width: fit-content;
      font-size: 11px;
    }

    .zoom-controls button:hover {
      background: #f0f0f0;
    }

    .zoom-info {
      position: absolute;
      top: 8px;
      left: 8px;
      z-index: 10;
      font-size: 10px;
      color: #666;
      background: rgba(255, 255, 255, 0.9);
      padding: 4px 6px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    canvas { border: none; }

    /* Drag-over visual feedback for canvas */
    .upper-canvas.drag-over,
    #diagram-canvas.drag-over {
      outline: 3px dashed #0066ff;
      outline-offset: -3px;
      background-color: rgba(0, 102, 255, 0.03);
    }
  </style>

  <!-- Fabric.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>
  <!-- gif.js (for GIF encoding) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="header-left">
      <button id="copy-tree" class="export-btn">copy tree</button>
    </div>
    <h1>Grammar App</h1>
    <div class="header-right">
      <span id="export-status" class="export-status"></span>
      <button id="download-tree" class="export-btn">download tree</button>
    </div>
  </header>

  <div class="top-palettes">
    <div class="palette-section clauses-section">
      <div class="palette-row">
        <div class="palette-tile white-bg" data-type="clause" data-value="S" draggable="true">S</div>
        <div class="palette-tile white-bg" data-type="clause" data-value="IC" draggable="true">IC</div>
        <div class="palette-tile white-bg" data-type="clause" data-value="DC" draggable="true">DC</div>
        <div class="palette-tile white-bg" data-type="clause" data-value="RC" draggable="true">RC</div>
        <div class="palette-tile white-bg" data-type="clause" data-value="CC" draggable="true">CC</div>
      </div>
    </div>

    <div class="palette-section phrases-section">
      <div class="palette-row">
        <div class="palette-tile" data-type="phrase" data-value="NP" style="background-color: #F1948A; color: #000;" draggable="true">NP</div>
        <div class="palette-tile" data-type="phrase" data-value="VP" style="background-color: #58D68D; color: #000;" draggable="true">VP</div>
        <div class="palette-tile" data-type="phrase" data-value="PP" style="background-color: #BDC3C7; color: #000;" draggable="true">PP</div>
        <div class="palette-tile" data-type="phrase" data-value="ADJP" style="background-color: #F7DC6F; color: #000;" draggable="true">ADJP</div>
        <div class="palette-tile" data-type="phrase" data-value="ADVP" style="background-color: #85C1E9; color: #000;" draggable="true">ADVP</div>
      </div>
    </div>
  </div>

  <div id="canvas-wrapper">
    <div class="zoom-info">Double-click tiles to connect them • Ctrl+click to edit • Click lines to disconnect • Delete to remove</div>
    <div class="zoom-controls">
      <button id="zoom-in">+</button>
      <button id="zoom-out">-</button>
      <button id="zoom-reset">Reset</button>
    </div>
    <canvas id="diagram-canvas"></canvas>
  </div>

  <div class="bottom-palettes">
    <div class="palette-section open-class-section">
      <div class="palette-row">
        <div class="palette-tile" data-type="word" data-value="noun" style="background-color: #E74C3C; color: #fff;" draggable="true">NOUN</div>
        <div class="palette-tile" data-type="word" data-value="verb" style="background-color: #27AE60; color: #fff;" draggable="true">VERB</div>
        <div class="palette-tile" data-type="word" data-value="adjective" style="background-color: #F1C40F; color: #000;" draggable="true">ADJ</div>
        <div class="palette-tile" data-type="word" data-value="adverb" style="background-color: #3498DB; color: #fff;" draggable="true">ADV</div>
      </div>
    </div>

    <div class="palette-section closed-class-section">
      <div class="palette-row">
        <div class="palette-tile" data-type="word" data-value="determiner" style="background-color: #F39C12; color: #fff;" draggable="true">DET</div>
        <div class="palette-tile" data-type="word" data-value="pronoun" style="background-color: #E67E22; color: #fff;" draggable="true">PRON</div>
        <div class="palette-tile" data-type="word" data-value="preposition" style="background-color: #95A5A6; color: #fff;" draggable="true">PREP</div>
        <div class="palette-tile" data-type="word" data-value="conjunction" style="background-color: #34495E; color: #fff;" draggable="true">CONJ</div>
        <div class="palette-tile" data-type="word" data-value="modal" style="background-color: #8E44AD; color: #fff;" draggable="true">MOD</div>
        <div class="palette-tile" data-type="word" data-value="auxiliary" style="background-color: #16A085; color: #fff;" draggable="true">AUX</div>
        <div class="palette-tile" data-type="word" data-value="interjection" style="background-color: #E91E63; color: #fff;" draggable="true">INTJ</div>
        <div class="palette-tile" data-type="word" data-value="relativizer" style="background-color: #9B59B6; color: #fff;" draggable="true">REL</div>
        <div class="palette-tile" data-type="word" data-value="complementizer" style="background-color: #2C3E50; color: #fff;" draggable="true">COMP</div>
      </div>
    </div>
  </div>

  <script>
    // Keep the existing drag-start helper for palette tiles so script.js can read it
    document.addEventListener('DOMContentLoaded', function() {
      const tiles = document.querySelectorAll('.palette-tile');
      tiles.forEach(tile => {
        tile.addEventListener('dragstart', function(e) {
          this.classList.add('dragging');
          const data = {
            type: this.getAttribute('data-type'),
            value: this.getAttribute('data-value')
          };
          e.dataTransfer.setData('text/plain', JSON.stringify(data));
          e.dataTransfer.effectAllowed = 'copy';
        });
        tile.addEventListener('dragend', function(e) {
          this.classList.remove('dragging');
        });
      });

      // Canvas element accepts drops; actual handling is in script.js
      const canvas = document.getElementById('diagram-canvas');
      canvas.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';
      });
      canvas.addEventListener('drop', function(e) {
        e.preventDefault();
      });
    });
  </script>

  <script src="script.js"></script>
</body>
</html>
